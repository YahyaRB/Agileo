<div class="modal-dialog modal-xl" role="document">
  <div class="modal-content">
    <form [formGroup]="myFormRegister" (ngSubmit)="onRegisterConsommation()">
      <div class="modal-header">
        <h5 class="modal-title text-success">Ajouter une consommation</h5>

        <button type="button" class="close text-success" data-dismiss="modal" aria-label="Fermer" #closebutton>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <!-- Message de chargement utilisateur -->
        <div *ngIf="isLoadingUser" class="text-center py-3">
          <div class="spinner-border spinner-border-sm" role="status">
            <span class="sr-only">Chargement des permissions...</span>
          </div>
          <small class="d-block mt-2">Vérification des permissions...</small>
        </div>

        <!-- Contenu principal du formulaire -->
        <div *ngIf="!isLoadingUser">
          <!-- Affaire -->
          <div class="form-row">
            <div class="form-group col-md-12">
              <label class="mr-2 mb-1 d-block">Affaire</label>

              <!-- Message si aucune affaire disponible -->
              <div *ngIf="affaires && affaires.length === 0" class="w-100">
                <div class="alert alert-warning mb-0">
                  <small>
                    <i class="fa fa-exclamation-triangle"></i>
                    Aucune affaire disponible pour vos permissions
                  </small>
                </div>
              </div>

              <!-- Sélection des affaires -->
              <ng-select *ngIf="affaires && affaires.length > 0"
                         class="w-100"
                         placeholder="Sélectionnez une affaire"
                         formControlName="affaire"
                         name="affaire">
                <ng-option *ngFor="let affaire of affaires" [value]="affaire">
                  {{affaire.affaire}} - {{affaire.libelle}}
                </ng-option>
              </ng-select>
            </div>
          </div>
          <!-- Information sur les affaires accessibles -->


          <div *ngIf="currentUser && affaires && affaires.length > 0" class="form-row">
            <div class="form-group col-md-10">
              <small class="text-info">
                <i class="fa fa-info-circle"></i>
                <span *ngIf="canViewAllAffaires()">
          Vous avez accès à toutes les affaires ({{ affaires.length }} disponibles)
        </span>
                <span *ngIf="!canViewAllAffaires()">
          Vous avez accès à {{ affaires.length }} affaire(s) assignée(s)
        </span>
              </small>
            </div>
          </div>
          <!-- Date de consommation -->
          <div class="form-row mt-3">
            <div class="form-group col-md-6">
              <label class="mr-2 mb-1 d-block">Date de consommation</label>
              <input type="date"
                     class="form-control"
                     formControlName="dateConsommation">
            </div>
          </div>


        </div>

      </div>

      <div class="modal-footer">
        <button type="submit"
                class="btn btn-success"
                [disabled]="myFormRegister.invalid || isLoadingUser || (affaires && affaires.length === 0)">
          <span *ngIf="isLoadingUser" class="spinner-border spinner-border-sm mr-1" role="status"></span>
          Enregistrer
        </button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="resetForms()">Annuler</button>
      </div>
    </form>
  </div>
</div>
