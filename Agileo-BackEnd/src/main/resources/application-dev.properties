# ============ APPLICATION CONFIGURATION ============
spring.application.name=AGILEO
server.port=8081

keycloak.admin.server-url=http://192.168.77.21:8081
keycloak.admin.realm=RB-realm
keycloak.admin.client-id=admin-cli
keycloak.admin.username=admin
keycloak.admin.password=m@ster0312

spring.security.oauth2.resourceserver.jwt.issuer-uri=http://192.168.77.21:8081/realms/RB-realm
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://192.168.77.21:8081/realms/RB-realm/protocol/openid-connect/certs
keycloak.auth-server-url=http://192.168.77.21:8081

cors.allowed-origins=http://localhost:4200,http://192.168.77.17:8080,http://192.168.77.17:4200
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
cors.allowed-headers=*
cors.allow-credentials=true

keycloak.sync.enabled=true
keycloak.admin.timeout=5000
keycloak.admin.retry.max-attempts=3
keycloak.admin.retry.delay=1000

# ============ MULTI-DATABASE CONFIGURATION ============
# PRIMARY DataSource - Affaires, M6003, etc.
spring.datasource.primary.jdbc-url=jdbc:sqlserver://192.168.77.3:1433;databaseName=AGILEOTEST;encrypt=true;trustServerCertificate=true;
spring.datasource.primary.username=UserAppRB
spring.datasource.primary.password=Richebois@1977
spring.datasource.primary.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver

# PRIMARY Hikari Configuration
spring.datasource.primary.hikari.maximum-pool-size=20
spring.datasource.primary.hikari.minimum-idle=5
spring.datasource.primary.hikari.idle-timeout=300000
spring.datasource.primary.hikari.pool-name=PrimaryHikariCP
spring.datasource.primary.hikari.max-lifetime=1200000
spring.datasource.primary.hikari.connection-timeout=30000
spring.datasource.primary.hikari.auto-commit=false

# SECONDARY DataSource - Users, Roles, etc.
spring.datasource.secondary.jdbc-url=jdbc:sqlserver://192.168.77.3:1433;databaseName=AgileoRB;encrypt=true;trustServerCertificate=true
spring.datasource.secondary.username=UserAppRB
spring.datasource.secondary.password=Richebois@1977
spring.datasource.secondary.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver

# SECONDARY Hikari Configuration
spring.datasource.secondary.hikari.maximum-pool-size=10
spring.datasource.secondary.hikari.minimum-idle=2
spring.datasource.secondary.hikari.idle-timeout=300000
spring.datasource.secondary.hikari.pool-name=SecondaryHikariCP
spring.datasource.secondary.hikari.max-lifetime=1200000
spring.datasource.secondary.hikari.connection-timeout=30000
spring.datasource.secondary.hikari.auto-commit=false

spring.sql.init.mode=never

# ============ JPA/HIBERNATE CONFIGURATION ============
# Configuration globale
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# Correction: utiliser jakarta au lieu de javax
spring.jpa.properties.jakarta.persistence.validation.mode=none

# Retirer le dialect - Hibernate le detecte automatiquement
# spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServer2012Dialect

spring.jpa.properties.hibernate.legacy_limit_handler=true
spring.jpa.properties.hibernate.dialect.pagination.offset_fetch_supported=false
spring.jpa.properties.hibernate.use_sql_comments=false

# ============ JPA TRANSACTION CONFIGURATION ============
spring.jpa.properties.hibernate.current_session_context_class=org.springframework.orm.hibernate5.SpringSessionContext
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ============ JPA AUDITING CONFIGURATION ============
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

# ============ TRANSACTION MANAGEMENT ============
spring.transaction.default-timeout=60
spring.transaction.rollback-on-commit-failure=true
spring.jpa.open-in-view=false

# ============ JACKSON CONFIGURATION ============
spring.jackson.time-zone=Africa/Casablanca
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# ============ AGILEO KEYCLOAK CONFIGURATION ============
agileo.keycloak.realm=RB-realm
agileo.keycloak.auth-server-url=http://192.168.77.21:8081
agileo.keycloak.client-id=agileo-backend
agileo.keycloak.client-secret=JnibEKK4V4swqudffcKQkG3ix9ORw4EK

# ============ SECURITY CONFIGURATION ============
spring.main.allow-bean-definition-overriding=true
lombok.equalsAndHashCode.doNotUseGetters=true

# ============ FILE UPLOAD CONFIGURATION ============
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=50MB
spring.servlet.multipart.location=temp/

spring.web.resources.static-locations=classpath:/static/
spring.web.resources.cache.cachecontrol.max-age=0
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**

app.upload.directory=uploads/
app.temp.directory=temp/
app.upload.max-file-size=52428800
app.upload.max-request-size=524288000

# ============ ACTUATOR CONFIGURATION ============
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when_authorized
management.info.env.enabled=true

# ============ ERROR HANDLING ============
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false

# ============ PERFORMANCE OPTIMIZATION ============
spring.jpa.defer-datasource-initialization=false

# ============ JSON CONFIGURATION ============
spring.mvc.contentnegotiation.favor-parameter=false
spring.mvc.contentnegotiation.favor-path-extension=false
spring.mvc.contentnegotiation.media-types.json=application/json

# ============ REMOTE FILE SERVER CONFIGURATION ============
app.path.globalVariable=C:\\Users\\a.yahya\\Documents\\pieces_jointe

# ============ LOGGING CONFIGURATION ============
logging.level.org.springframework.web.multipart.support.StandardServletMultipartResolver=ERROR
logging.level.org.apache.catalina.connector.Request=ERROR
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN